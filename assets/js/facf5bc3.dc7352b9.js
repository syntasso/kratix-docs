"use strict";(self.webpackChunkkratix_docs=self.webpackChunkkratix_docs||[]).push([[7964],{22748:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"main/reference/observability","title":"Observability","description":"How to observe Kratix through logs, metrics, traces, and status.","source":"@site/docs/main/03-reference/20-observability.md","sourceDirName":"main/03-reference","slug":"/main/reference/observability","permalink":"/main/reference/observability","draft":false,"unlisted":false,"editUrl":"https://github.com/syntasso/kratix-docs/tree/main/docs/main/03-reference/20-observability.md","tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"title":"Observability","sidebar_label":"Observability","description":"How to observe Kratix through logs, metrics, traces, and status.","id":"observability","keywords":["observability","tracing","open telemetry","logging","logs","probes"]},"sidebar":"mainSidebar","previous":{"title":"Kratix Config","permalink":"/main/reference/kratix-config/config"},"next":{"title":"Uninstalling Kratix","permalink":"/main/reference/deleting-kratix"}}');var s=r(74848),t=r(28453);const o={title:"Observability",sidebar_label:"Observability",description:"How to observe Kratix through logs, metrics, traces, and status.",id:"observability",keywords:["observability","tracing","open telemetry","logging","logs","probes"]},l="Observability",c={},a=[{value:"What to observe",id:"what-to-observe",level:2},{value:"Logs",id:"logs",level:2},{value:"Probes",id:"probes",level:2},{value:"Metrics",id:"metrics",level:2},{value:"Tracing (OpenTelemetry)",id:"tracing-opentelemetry",level:2},{value:"Status, conditions, and events",id:"status-conditions-and-events",level:2},{value:"Health checks",id:"health-checks",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"observability",children:"Observability"})}),"\n",(0,s.jsx)(n.h2,{id:"what-to-observe",children:"What to observe"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Controller manager:"})," reconciliation decisions, scheduling, and workflow\norchestration for Promises and Resources."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Workflows:"})," pipeline Jobs/Pods for Promise and Resource workflows."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"CRD status and events:"})," conditions and status fields for Promises, Resources,\nWork, and WorkPlacement."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Health Records:"})," CRDs that drive health status updates on Resources."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"logs",children:"Logs"}),"\n",(0,s.jsxs)(n.p,{children:["Kratix logs are emitted by the controller manager and by workflow pipeline pods.\nThe controller manager runs in the ",(0,s.jsx)(n.code,{children:"kratix-platform-system"})," namespace. You can\ncontrol log verbosity and format via the ",(0,s.jsx)(n.code,{children:"logging"})," settings in the\n",(0,s.jsx)(n.a,{href:"/main/reference/kratix-config/config",children:"Kratix Config"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"structured"})," logging is enabled, the controller emits JSON logs so you can\nparse and route logs programmatically. Example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{"level":"info","ts":"2025-05-07T15:46:59Z","logger":"controllers.Promise","msg":"reconciliation finished","controller":"promise","name":"webapp","generation":1,"severity":"info","duration":0.023759875}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Common fields to expect:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ts"}),": RFC3339 timestamp."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"level"}),"/",(0,s.jsx)(n.code,{children:"severity"}),": log level (info, warning, debug, trace)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"logger"}),": source logger (often controller-specific)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"msg"}),": human-readable message."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"controller"}),": controller name (e.g. ",(0,s.jsx)(n.code,{children:"promise"}),", ",(0,s.jsx)(n.code,{children:"resource"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"name"}),"/",(0,s.jsx)(n.code,{children:"namespace"}),": object identifiers (when applicable)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"generation"}),": object generation reconciled."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"duration"}),": operation duration in seconds."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"structured"})," logging is disabled, logs are emitted as human-readable text."]}),"\n",(0,s.jsxs)(n.p,{children:["For workflow logs and common investigation steps, see\n",(0,s.jsx)(n.a,{href:"/main/troubleshooting",children:"Troubleshooting"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"probes",children:"Probes"}),"\n",(0,s.jsx)(n.p,{children:"The controller manager Deployment configures liveness, readiness, and startup\nprobes. Inspect them with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl -n kratix-platform-system describe deployment kratix-platform-controller-manager\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Readiness probe:"})," if it fails, the pod is marked NotReady and Kubernetes\nstops routing traffic to it (e.g. Services remove the endpoint). Readiness can\nfail when the controller manager cannot serve its readiness endpoint, such as\nduring startup or when the API client/cache is unhealthy."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Liveness probe:"})," if it fails, Kubernetes restarts the pod."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Startup probe:"})," gates liveness/readiness checks during startup; repeated\nfailures cause a restart."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"metrics",children:"Metrics"}),"\n",(0,s.jsxs)(n.p,{children:["Kratix exposes a Prometheus-compatible ",(0,s.jsx)(n.code,{children:"/metrics"})," endpoint via the\n",(0,s.jsx)(n.code,{children:"kratix-platform-controller-manager-metrics-service"})," Service in the\n",(0,s.jsx)(n.code,{children:"kratix-platform-system"})," namespace. The metrics follow the default Kubebuilder\ncontroller metrics set; see the\n",(0,s.jsx)(n.a,{href:"https://book.kubebuilder.io/reference/metrics-reference.html",children:"Kubebuilder metrics reference"}),"\nfor details."]}),"\n",(0,s.jsx)(n.p,{children:"Metrics worth watching early:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"controller_runtime_reconcile_errors_total"}),": reconciliation errors by controller."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"controller_runtime_reconcile_time_seconds"}),": time per reconciliation."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"workqueue_depth"}),": queue depth for reconcile work."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"workqueue_retries_total"}),": retries on reconcile items."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"rest_client_requests_total"}),": API request volume and errors by status code."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"To scrape metrics with Prometheus, follow the metrics collection steps in the\ninstalling guides for your platform:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/main/guides/installing-kratix-AKS#configuring-metrics-collection",children:"AKS"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/main/guides/installing-kratix-EKS#configuring-metrics-collection",children:"EKS"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/main/guides/installing-kratix-GKE#configuring-metrics-collection",children:"GKE"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/main/guides/installing-kratix-openshift#configuring-metrics-collection",children:"OpenShift"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/main/guides/installing-kratix-others#configuring-metrics-collection",children:"Other Kubernetes"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"We are keen to hear which additional metrics would be useful in your environment."}),"\n",(0,s.jsx)(n.h2,{id:"tracing-opentelemetry",children:"Tracing (OpenTelemetry)"}),"\n",(0,s.jsxs)(n.p,{children:["Kratix can export OpenTelemetry data when ",(0,s.jsx)(n.code,{children:"telemetry"})," is enabled in the\n",(0,s.jsx)(n.a,{href:"/main/reference/kratix-config/config",children:"Kratix Config"}),". Configure the endpoint and\nprotocol to send data to your collector."]}),"\n",(0,s.jsx)(n.p,{children:"OpenTelemetry support is a newly released feature; we would love feedback and\nguidance on what signals and spans you would expect from Kratix."}),"\n",(0,s.jsx)(n.h2,{id:"status-conditions-and-events",children:"Status, conditions, and events"}),"\n",(0,s.jsx)(n.p,{children:"Kratix surfaces workflow progress and outcomes via status conditions on Resources\nand related CRDs. Pipelines can also write status data back to Resources. See:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/main/learn-more/status-conditions-events/resource-status-events",children:"Resource Status and Events"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/main/learn-more/status-conditions-events/promise-status-events",children:"Promise Status and Events"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"kubectl describe"})," and ",(0,s.jsx)(n.code,{children:"kubectl get -o yaml"})," to inspect conditions and events\nwhile debugging."]}),"\n",(0,s.jsx)(n.h2,{id:"health-checks",children:"Health checks"}),"\n",(0,s.jsxs)(n.p,{children:["Health checks are represented by the ",(0,s.jsx)(n.code,{children:"HealthRecord"})," CRD, which Kratix uses to\nupdate the Resource Request status with health information."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/main/reference/healthrecord",children:"Health Record reference"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/main/guides/resource-health",children:"Surfacing health information"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var i=r(96540);const s={},t=i.createContext(s);function o(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);