"use strict";(self.webpackChunkkratix_docs=self.webpackChunkkratix_docs||[]).push([[5215],{4137:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>g,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"ske/integrations/backstage/generating-backstage-components","title":"Generating Backstage Components","description":"Documentation for how to use the Backstage Controller to generate Backstage Components","source":"@site/docs/ske/10-integrations/10-backstage/04-generating-backstage-components.mdx","sourceDirName":"ske/10-integrations/10-backstage","slug":"/ske/integrations/backstage/generating-backstage-components","permalink":"/ske/integrations/backstage/generating-backstage-components","draft":false,"unlisted":false,"editUrl":"https://github.com/syntasso/kratix-docs/tree/main/docs/ske/10-integrations/10-backstage/04-generating-backstage-components.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Generating Backstage Components","description":"Documentation for how to use the Backstage Controller to generate Backstage Components","sidebar_label":"Generating Backstage Components"},"sidebar":"skeSidebar","previous":{"title":"Configuring the Plugins","permalink":"/ske/integrations/backstage/plugins"},"next":{"title":"YAML File Format","permalink":"/ske/integrations/backstage/yaml-file-format"}}');var a=n(4848),o=n(8453);const i={title:"Generating Backstage Components",description:"Documentation for how to use the Backstage Controller to generate Backstage Components",sidebar_label:"Generating Backstage Components"},r=void 0,c={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Authenticating against the image registry",id:"authenticating-against-the-image-registry",level:3},{value:"SKE Backstage plugins",id:"ske-backstage-plugins",level:3},{value:"Backstage Destination",id:"destination",level:3},{value:"Installing the Backstage Controller",id:"installing-the-backstage-controller",level:2},{value:"How does it work?",id:"how-does-it-work",level:2},{value:"Promise Configure",id:"promise-configure",level:3},{value:"Resource Configure",id:"resource-configure",level:3},{value:"Labelling Promises for automatic file generation",id:"labelling-promises-for-automatic-file-generation",level:3},{value:"Customize Backstage Components",id:"customize-backstage-components",level:2},{value:"Custom containers",id:"custom-containers",level:3},{value:"Destination Selectors",id:"destination-selectors",level:3}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"The Backstage Controller generates Backstage components and templates for Promises and Resource Requests."}),"\n",(0,a.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsx)(t.h3,{id:"authenticating-against-the-image-registry",children:"Authenticating against the image registry"}),"\n",(0,a.jsxs)(t.p,{children:["Both the Backstage Controller image and the SKE Backstage Generator image used by the Controller are hosted in a private registry, to access\nthese images when Deploying and using the Backstage Controller deployment, you will need to authenticate using the token you have been provided with.\nYou can define your authentication credentials via a ",(0,a.jsx)(t.code,{children:"docker-registry"})," secret named ",(0,a.jsx)(t.code,{children:"syntasso-registry"}),":"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"kubectl create secret docker-registry syntasso-registry \\\n  --docker-server=registry.syntasso.io \\\n  --docker-username=syntasso-pkg \\\n  --docker-password=YOUR_TOKEN \\\n  --namespace kratix-platform-system\n"})}),"\n",(0,a.jsxs)(t.p,{children:["The above command creates a Kubernetes Secret in namespace ",(0,a.jsx)(t.code,{children:"kratix-platform-system"}),".\nFor any resource requests created in other namespaces, you need to create the same registry secret in them as well."]}),"\n",(0,a.jsx)(t.h3,{id:"ske-backstage-plugins",children:"SKE Backstage plugins"}),"\n",(0,a.jsxs)(t.p,{children:["The generated Backstage Templates reference an action from the ",(0,a.jsx)(t.code,{children:"ske-backend"})," Backstage plugin, this action is\nused to create a Resource Request.\nThe generated Components are also used by the ",(0,a.jsx)(t.code,{children:"ske-frontend"})," Backstage plugin to display\nPromise and Resource metadata."]}),"\n",(0,a.jsxs)(t.p,{children:["In order to utilise the Templates and Components, you should also install both the\n",(0,a.jsx)(t.code,{children:"ske-backend"})," and ",(0,a.jsx)(t.code,{children:"ske-frontend"})," plugins into your Backstage instance."]}),"\n",(0,a.jsxs)(t.p,{children:["See ",(0,a.jsx)(t.a,{href:"./plugins",children:"Configuring the Plugins"})," for installation instructions."]}),"\n",(0,a.jsx)(t.h3,{id:"destination",children:"Backstage Destination"}),"\n",(0,a.jsxs)(t.p,{children:["You must have a Destination created with the ",(0,a.jsx)(t.code,{children:"environment: backstage"})," label. See the\n",(0,a.jsx)(t.a,{href:"./configuring-backstage#configure-a-destination-for-backstage",children:"Kratix Backstage docs"}),"\nfor setup instructions."]}),"\n",(0,a.jsxs)(t.admonition,{type:"warning",children:[(0,a.jsxs)(t.p,{children:["You will need SKE ",(0,a.jsx)(t.code,{children:"0.28.0"})," or later for Backstage Controller to work."]}),(0,a.jsx)(t.h2,{id:"installing-the-backstage-controller",children:"Installing the Backstage Controller"}),(0,a.jsxs)(t.p,{children:["The Controller is released separately from SKE. Its releases can be found ",(0,a.jsx)(t.a,{href:"../../releases/backstage-controller",children:"here"}),"."]}),(0,a.jsx)(t.p,{children:"You can apply the Controller by installing the distribution at the desired version:"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"kubectl apply -f http://syntasso-enterprise-releases.s3-website.eu-west-2.amazonaws.com/#backstage-controller/<VERSION>/backstage-controller.yaml\n"})}),(0,a.jsx)(t.h2,{id:"how-does-it-work",children:"How does it work?"}),(0,a.jsx)(t.p,{children:"The SKE Backstage Controller creates a Workflow that automatically generates the Backstage components and\ntemplates for your Promise. This Workflow runs in addition to the Configure Workflow for your Promises and Requests."}),(0,a.jsx)(t.h3,{id:"promise-configure",children:"Promise Configure"}),(0,a.jsx)(t.p,{children:"In a Promise Configure workflow, two Backstage manifests will be generated:"}),(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Promise Component:"})," A Backstage Component representing the Promise."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Promise Template:"})," A Backstage Template representing the Promise API (i.e. the CRD\nfor Resources created from this Promise)."]}),"\n"]}),(0,a.jsx)(t.h3,{id:"resource-configure",children:"Resource Configure"}),(0,a.jsx)(t.p,{children:"In a Resource Configure workflow, a single Backstage manifest will be generated:"}),(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Resource Component:"})," A Backstage Component representing the Resource."]}),"\n"]}),(0,a.jsxs)(t.p,{children:["Check the ",(0,a.jsx)(t.a,{href:"./yaml-file-format",children:"YAML File Format"})," for examples of these manifests"]}),(0,a.jsx)(t.h3,{id:"labelling-promises-for-automatic-file-generation",children:"Labelling Promises for automatic file generation"}),(0,a.jsxs)(t.p,{children:["To generate Backstage Components and Template for your Promise, as well as Components for requests for that Promise,\nlabel your Promise with ",(0,a.jsx)(t.code,{children:"kratix.io/backstage: true"}),"."]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"kubectl label promises PROMISE_NAME kratix.io/backstage=true\n"})}),(0,a.jsx)(t.p,{children:"Or add the label to the Promise spec:"}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:'apiVersion: platform.kratix.io/v1alpha1\nkind: Promise\nmetadata:\n  name: my-promise\n  labels:\n    kratix.io/backstage: "true"\n'})}),(0,a.jsx)(t.h2,{id:"customize-backstage-components",children:"Customize Backstage Components"}),(0,a.jsxs)(t.p,{children:["You can customize the automatically generated Backstage Components and Templates by creating a cluster-wide\n",(0,a.jsx)(t.code,{children:"BackstageEntityCustomization"}),":"]}),(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"apiVersion: platform.kratix.io/v1alpha1\nkind: BackstageEntityCustomization\nmetadata:\n  name: my-customization\nspec:\n  destinationSelectors: # optional\n  - matchLabels:\n      environment: backstage\n  containers: # optional\n    - name: add-backstage-group\n      image: ghcr.io/syntasso/run-customization:v0.0.1\n"})}),(0,a.jsx)(t.h3,{id:"custom-containers",children:"Custom containers"}),(0,a.jsxs)(t.p,{children:["The containers defined in the customization will run after the ",(0,a.jsx)(t.code,{children:"backstage-gen"})," container which generates the\nComponents and Templates. They can be used to modify the existing ",(0,a.jsx)(t.code,{children:"catalog-info.yaml"})," file created by the\n",(0,a.jsx)(t.code,{children:"ske-backstage-generator"})," or it can generate new files. This customization will apply to all Promises with label\n",(0,a.jsx)(t.code,{children:"kratix.io/backstage: true"})," as well as Resource Requests for these promises."]}),(0,a.jsxs)(t.p,{children:["If you want to edit the ",(0,a.jsx)(t.code,{children:"catalog.info"})," or generate different files based on whether the Workflow is running for a\nPromise or Resource Request, the container can query the ",(0,a.jsx)(t.code,{children:"KRATIX_WORKFLOW_TYPE"})," environment variable.\nFor Promises, this is equal to ",(0,a.jsx)(t.code,{children:"promise-backstage-gen"})," and for resources, ",(0,a.jsx)(t.code,{children:"resource-backstage-gen"}),"."]}),(0,a.jsx)(t.h3,{id:"destination-selectors",children:"Destination Selectors"}),(0,a.jsx)(t.p,{children:"By default, Destination selectors defined in the customization will apply to all generated Backstage components.\nYou can use these to make sure that generated components are only scheduled to your Backstage destinations."})]})]})}function g(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>r});var s=n(6540);const a={},o=s.createContext(a);function i(e){const t=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);