"use strict";(self.webpackChunkkratix_docs=self.webpackChunkkratix_docs||[]).push([[30],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>m});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},l=Object.keys(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)r=l[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var o=n.createContext({}),u=function(e){var t=n.useContext(o),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},c=function(e){var t=u(e.components);return n.createElement(o.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,l=e.originalType,o=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=u(r),m=a,k=d["".concat(o,".").concat(m)]||d[m]||p[m]||l;return r?n.createElement(k,s(s({ref:t},c),{},{components:r})):n.createElement(k,s({ref:t},c))}));function m(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=r.length,s=new Array(l);s[0]=d;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i.mdxType="string"==typeof e?e:a,s[1]=i;for(var u=2;u<l;u++)s[u]=r[u];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},3135:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>p,frontMatter:()=>l,metadata:()=>i,toc:()=>u});var n=r(7462),a=(r(7294),r(3905));const l={description:"Tutorial on adding a new Worker Cluster",title:"Adding a new Worker Cluster"},s=void 0,i={unversionedId:"main/guides/scheduling-clusters",id:"main/guides/scheduling-clusters",title:"Adding a new Worker Cluster",description:"Tutorial on adding a new Worker Cluster",source:"@site/docs/main/05-guides/07-scheduling-clusters.md",sourceDirName:"main/05-guides",slug:"/main/guides/scheduling-clusters",permalink:"/docs/main/guides/scheduling-clusters",draft:!1,editUrl:"https://github.com/syntasso/kratix-docs/tree/main/docs/main/05-guides/07-scheduling-clusters.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{description:"Tutorial on adding a new Worker Cluster",title:"Adding a new Worker Cluster"},sidebar:"mainSidebar",previous:{title:"Enhancing a Promise",permalink:"/docs/main/guides/enhancing-a-promise"},next:{title:"Composite Promise",permalink:"/docs/main/guides/composite-promises"}},o={},u=[{value:"Pre-requisites",id:"pre-requisites",level:2},{value:"Preparing the new Cluster",id:"preparing-the-new-cluster",level:2},{value:"Registering the Cluster",id:"registering-the-cluster",level:2},{value:"\ud83c\udf89 Congratulations",id:"-congratulations",level:2}],c={toc:u};function p(e){let{components:t,...r}=e;return(0,a.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"One of the most powerful features of Kratix is its ability to react when new Kubernetes\nClusters are added to the platform. By default, any Promise installed in the Platform\ncluster will be automatically installed in the clusters joining the platform."),(0,a.kt)("h2",{id:"pre-requisites"},"Pre-requisites"),(0,a.kt)("p",null,"To see this in action, you will need an environment running Kratix with a Promise\ninstalled. For that, you can follow the ",(0,a.kt)("a",{parentName:"p",href:"installing-a-promise"},"Installing a Promise"),"\nguide. Before continuing, ensure you have a Platform Cluster and a Worker Cluster created\nwith KinD:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell-session"},"$ kind get clusters\nplatform\nworker\n\n$ kubectl --context kind-platform get clusters.platform.kratix.io\nNAME               AGE\nworker-cluster-1   1h\n")),(0,a.kt)("p",null,"You should also have a Jenkins Promise installed:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell-session"},"$ kubectl --context kind-platform get promises.platform.kratix.io\nNAME              AGE\njenkins-promise   1h\n")),(0,a.kt)("p",null,"On the Worker Cluster, you should see the Jenkins Operator running:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell-session"},"$ kubectl --context kind-worker get pods\nNAME                                READY   STATUS    RESTARTS   AGE\njenkins-operator-778d6fc487-gczpb   1/1     Running   0          1h\n")),(0,a.kt)("h2",{id:"preparing-the-new-cluster"},"Preparing the new Cluster"),(0,a.kt)("p",null,"You will now add a new Cluster to the Platform Cluster and watch Kratix reconciling the\nsystem. For that, you need to first create the new Kubernetes cluster:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kind create cluster --name worker-cluster-2\n")),(0,a.kt)("p",null,"Next, install the GitOps toolkit and create the necessary GitOps resources. The quickest\nway to do that is to run the ",(0,a.kt)("inlineCode",{parentName:"p"},"./scripts/install-gitops")," script from the Kratix root\ndirectory:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"cd /path/to/kratix\n./scripts/install-gitops --context kind-worker-cluster-2 --bucket-path worker-cluster-2\n")),(0,a.kt)("h2",{id:"registering-the-cluster"},"Registering the Cluster"),(0,a.kt)("p",null,"You can now register your cluster. Create a file called ",(0,a.kt)("inlineCode",{parentName:"p"},"worker-cluster-2.yaml")," with the\nfollowing contents:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="worker-cluster-2.yaml"',title:'"worker-cluster-2.yaml"'},"apiVersion: platform.kratix.io/v1alpha1\nkind: Cluster\nmetadata:\n  name: worker-cluster-2\n  labels:\n    environment: dev\nspec:\n  id: worker-cluster-2-id\n  bucketPath: worker-cluster-2\n")),(0,a.kt)("p",null,"Apply the Cluster document to the Platform cluster:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl --context kind-platform apply --filename worker-cluster-2.yaml\n")),(0,a.kt)("p",null,"Check the Cluster was created:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell-session",metastring:"{4}","{4}":!0},"$ kubectl --context kind-platform get clusters.platform.kratix.io\nNAME               AGE\nworker-cluster-1   1h\nworker-cluster-2   1h\n")),(0,a.kt)("p",null,"Kratix will react to the new Cluster by scheduling the installation of the Jenkins Promise\nto the new Worker Cluster. After a couple of minutes, you should see the Jenkins Operator\nrunning on the new Worker Cluster:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell-session",metastring:"{3}","{3}":!0},"$ kubectl --context kind-worker-cluster-2 get pods\nNAME                                READY   STATUS    RESTARTS   AGE\njenkins-operator-778d6fc487-c9w8f   1/1     Running   0          1h\n")),(0,a.kt)("p",null,"When you request a new Jenkins, the instance will be created in one of the available\nClusters, in a non-deterministic way."),(0,a.kt)("p",null,"For further documentation on Cluster Scheduling, check the ",(0,a.kt)("a",{parentName:"p",href:"../reference/clusters/intro"},"Cluster Reference\ndocumentation")),(0,a.kt)("h2",{id:"-congratulations"},"\ud83c\udf89 Congratulations"),(0,a.kt)("p",null,"\u2705","\xa0","\xa0"," You have created and registered a new Cluster and watched the system react to it.",(0,a.kt)("br",null),"\n\ud83d\udc49\ud83c\udffe","\xa0","\xa0"," Let's ",(0,a.kt)("a",{parentName:"p",href:"./composite-promises"},"write composite promises"),"."))}p.isMDXComponent=!0}}]);