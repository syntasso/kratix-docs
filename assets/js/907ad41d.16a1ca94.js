"use strict";(self.webpackChunkkratix_docs=self.webpackChunkkratix_docs||[]).push([[6615],{28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>r});var s=n(96540);const a={},i=s.createContext(a);function o(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(i.Provider,{value:t},e.children)}},69467:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"main/reference/statestore/bucketstatestore","title":"BucketStateStore","description":"Documentation for the Kratix BucketStateStore Custom Resource","source":"@site/docs/main/03-reference/14-statestore/03-bucketstatestore.md","sourceDirName":"main/03-reference/14-statestore","slug":"/main/reference/statestore/bucketstatestore","permalink":"/main/reference/statestore/bucketstatestore","draft":false,"unlisted":false,"editUrl":"https://github.com/syntasso/kratix-docs/tree/main/docs/main/03-reference/14-statestore/03-bucketstatestore.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"description":"Documentation for the Kratix BucketStateStore Custom Resource","title":"BucketStateStore","sidebar_label":"BucketStateStore","id":"bucketstatestore"},"sidebar":"mainSidebar","previous":{"title":"GitStateStore","permalink":"/main/reference/statestore/gitstatestore"},"next":{"title":"Introduction","permalink":"/main/reference/resources/intro"}}');var a=n(74848),i=n(28453);const o={description:"Documentation for the Kratix BucketStateStore Custom Resource",title:"BucketStateStore",sidebar_label:"BucketStateStore",id:"bucketstatestore"},r="BucketStateStore",c={},d=[{value:"S3-Compatible Providers",id:"s3-compatible-providers",level:3},{value:"Auth",id:"auth",level:2},{value:"Access Key",id:"access-key",level:3},{value:"IAM",id:"iam",level:3},{value:"Status",id:"status",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"bucketstatestore",children:"BucketStateStore"})}),"\n",(0,a.jsx)(t.p,{children:"Kratix supports writing to S3-Compatible buckets. See below for the API documentation:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"apiVersion: platform.kratix.io/v1alpha1\nkind: BucketStateStore\nmetadata:\n  name: default\nspec:\n  # Bucket name: required\n  bucketName: kratix\n  # The endpoint of the bucket provider: required\n  endpoint: s3.eu-west-2.amazonaws.com\n  # Skip TLS veritfication: optional, defaults to false\n  insecure: false\n  # The Top-level path in the Bucket repository to write to: optional\n  path: destinations/\n  # Valid options: accessKey, and IAM; defaults to accessKey\n  authMethod: accessKey\n  # Required when using accessKey auth method\n  secretRef:\n    # The name and namespace of the secret to use to authenticate \n    name: s3-credentials\n    namespace: default\n"})}),"\n",(0,a.jsx)(t.h3,{id:"s3-compatible-providers",children:"S3-Compatible Providers"}),"\n",(0,a.jsx)(t.p,{children:"Any S3-Compatible provider will work with Kratix. See the documentation on how\nto use some of the available providers below:"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.a,{href:"https://docs.aws.amazon.com/AmazonS3/latest/userguide/create-bucket-overview.html",children:"AWS S3"})}),"\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.a,{href:"https://cloud.google.com/storage/docs/interoperability",children:"GCS S3-compatible storage"})}),"\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.a,{href:"https://min.io/docs/minio/linux/reference/minio-mc/mc-mb.html",children:"MinIO"})}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"For other providers, please check their documentation for setting up a bucket and its credentials."}),"\n",(0,a.jsx)(t.h2,{id:"auth",children:"Auth"}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.code,{children:".spec.authMethod"})," key is used to determine which authentication method\nshould be used when communicating to the S3-Compatible API. There are two\nsupports types:"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.code,{children:"accessKey"})}),"\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.code,{children:"IAM"})}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"access-key",children:"Access Key"}),"\n",(0,a.jsxs)(t.p,{children:["When ",(0,a.jsx)(t.code,{children:"authMethod: accessKey"})," is set Kratix uses the credentials contained in the\n",(0,a.jsx)(t.code,{children:"secretRef"})," to authenticate with the S3-Compatible Bucket. The secret must\ncontain ",(0,a.jsx)(t.code,{children:"accessKeyID"})," and ",(0,a.jsx)(t.code,{children:"secretAccessKey"}),". Example:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"---\napiVersion: platform.kratix.io/v1alpha1\nkind: BucketStateStore\nmetadata:\n  name: default\nspec:\n  endpoint: minio.kratix-platform-system.svc.cluster.local\n  insecure: true\n  bucketName: kratix\n  secretRef:\n    name: minio-credentials\n    namespace: default\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: minio-credentials\n  namespace: default\ntype: Opaque\ndata:\n  accessKeyID: <base64 encoded accessKeyID>\n  secretAccessKey: <base64 encoded secretAccessKey>\n"})}),"\n",(0,a.jsx)(t.h3,{id:"iam",children:"IAM"}),"\n",(0,a.jsxs)(t.p,{children:["When ",(0,a.jsx)(t.code,{children:"authMethod: IAM"})," is set, Kratix will assume that the place in which it's\nrunning has been given permissions to authenticate with the S3 API using its\nIAM Role. In practise, this might mean that you are running Kratix in AWS, and that\nthe node role for the instance Kratix is running on has been given permissions\nto read/write to the bucket. Similarly, rather than giving the node role\npermissions, you may be using ",(0,a.jsx)(t.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html",children:"IAM Roles for\nServiceAccounts"}),"\nto give permissions to just the Kratix container. With both approaches the\nconfiguration for the State store is the same:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"---\napiVersion: platform.kratix.io/v1alpha1\nkind: BucketStateStore\nmetadata:\n  name: default\nspec:\n  bucketName: kratix-example-test\n  endpoint: s3.eu-west-2.amazonaws.com # ensure to change with your bucket region.\n  insecure: false\n  authMethod: IAM\n"})}),"\n",(0,a.jsxs)(t.p,{children:["When running in EKS you need to ensure your security group rules allow Kratix to\naccess the S3 API. If you are running the cluster in a restricted setup you can\ngrant the access to just the S3 API using ",(0,a.jsx)(t.a,{href:"https://docs.aws.amazon.com/vpc/latest/privatelink/vpc-endpoints-s3.html",children:"gateway VPC\nendpoints"})]}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsx)(t.admonition,{type:"info",children:(0,a.jsxs)(t.p,{children:["Require a different method of authentication? Get in touch with us at\n",(0,a.jsx)(t.a,{href:"mailto:feedback@syntasso.io?subject=Kratix%20Feedback",children:"feedback@syntasso.io"}),"\nor ",(0,a.jsx)(t.a,{href:"https://github.com/syntasso/kratix/issues/new",children:"open a GitHub Issue"}),"."]})}),"\n",(0,a.jsx)(t.h2,{id:"status",children:"Status"}),"\n",(0,a.jsxs)(t.p,{children:["The status of the BucketStateStore can be ",(0,a.jsx)(t.code,{children:"Ready"})," or ",(0,a.jsx)(t.code,{children:"NotReady"})," based on Kratix's availability to write to the State Store."]}),"\n",(0,a.jsxs)(t.p,{children:["A ",(0,a.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-conditions",children:"condition"})," of type ",(0,a.jsx)(t.code,{children:"Ready"})," is also provided to enable waiting for the State Store to be ready."]}),"\n",(0,a.jsx)(t.p,{children:"An example is provided below showing a BucketStateStore coming online, including events detailing any status changes."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{children:'$ kubectl describe bucketstatestores.platform.kratix.io default\nName:         default\n...\nStatus:\n  Conditions:\n    Last Transition Time:  2025-03-05T12:52:49Z\n    Message:               State store is ready\n    Reason:                StateStoreReady\n    Status:                True\n    Type:                  Ready\n  Status:                  Ready\nEvents:\n  Type    Reason  Age   From                        Message\n  ----    ------  ----  ----                        -------\n  Normal  Ready   11m   BucketStateStoreController  BucketStateStore "default" is ready\n'})})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}}}]);