"use strict";(self.webpackChunkkratix_docs=self.webpackChunkkratix_docs||[]).push([[7741],{5681:(e,n,s)=>{s.d(n,{Ay:()=>l,RM:()=>t});var i=s(4848),r=s(8453);const t=[{value:"Pre-requisites",id:"pre-requisites",level:4}];function a(e){const n={a:"a",code:"code",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h4,{id:"pre-requisites",children:"Pre-requisites"}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsxs)("summary",{children:["You need an installation of Kratix for this section. ",(0,i.jsx)("strong",{children:"Click here"})," for instructions"]}),(0,i.jsx)(n.p,{children:"The simplest way to do so is by running the quick-start script from within the\nKratix directory. The script will create two KinD clusters, install, and\nconfigure Kratix."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./scripts/quick-start.sh --recreate\n"})}),(0,i.jsx)(n.p,{children:"You can run Kratix either with a multi-cluster or a single-cluster setup. The\ncommands on the remainder of this document assume that two environment variables\nare set:"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PLATFORM"})," representing the platform cluster Kubernetes context"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WORKER"})," representing the worker cluster Kubernetes context"]}),"\n"]}),(0,i.jsx)(n.p,{children:"If you ran the quick-start script above, do:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'export PLATFORM="kind-platform"\nexport WORKER="kind-worker"\n'})}),(0,i.jsx)(n.p,{children:"For single cluster setups, the two variables should be set to the same value.\nYou can find your cluster context by running:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"kubectl config get-contexts\n"})}),(0,i.jsxs)(n.p,{children:["Refer back to ",(0,i.jsx)(n.a,{href:"../../category/installing-kratix",children:"Installing Kratix"})," for more\ndetails."]})]})]})}function l(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},786:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>h,contentTitle:()=>d,default:()=>m,frontMatter:()=>c,metadata:()=>i,toc:()=>u});const i=JSON.parse('{"id":"main/guides/installing-a-promise","title":"Installing and using a Promise","description":"Step by step guide to install Kratix and your first Promise.","source":"@site/docs/main/04-guides/03-installing-a-promise.mdx","sourceDirName":"main/04-guides","slug":"/main/guides/installing-a-promise","permalink":"/main/guides/installing-a-promise","draft":false,"unlisted":false,"editUrl":"https://github.com/syntasso/kratix-docs/tree/main/docs/main/04-guides/03-installing-a-promise.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Installing and using a Promise","description":"Step by step guide to install Kratix and your first Promise."},"sidebar":"mainSidebar","previous":{"title":"Others (KinD etc)","permalink":"/main/guides/installing-kratix-others"},"next":{"title":"Installing GitOps Agent","permalink":"/category/installing-gitops-agent"}}');var r=s(4848),t=s(8453),a=s(5681);function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"In this guide, you will"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#what-is-a-kratix-promise",children:"learn more about Kratix Promises"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#install-the-kratix-sample-jenkins-promise",children:"install Jenkins as a Kratix Promise"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"what-is-a-kratix-promise",children:"What is a Kratix Promise?"}),"\n",(0,r.jsxs)(n.p,{children:["Conceptually, Promises are the building blocks of Kratix that allow you to\ndevelop your platform incrementally. Technically, a Promise is a YAML document\nthat defines a contract between the Platform and its users. You can explore\nmore about this contract and the internals of a Kratix Promise in the ",(0,r.jsx)(n.a,{href:"writing-a-promise",children:"writing\na Promise"})," guide."]}),"\n",(0,r.jsx)(n.h2,{id:"kratix-promises",children:"Kratix Promises"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"enable you to build your platform incrementally and in response to the needs of your users."}),"\n",(0,r.jsx)(n.li,{children:"codify the contract between platform teams and application teams for the delivery of a specific service, e.g. a database, an identity service, a supply chain, or a complete development workflow including patterns and tools."}),"\n",(0,r.jsx)(n.li,{children:"are easy to build, deploy, and update."}),"\n",(0,r.jsx)(n.li,{children:"are shareable and reusable between platforms, teams, business units, and other organisations."}),"\n",(0,r.jsx)(n.li,{children:"add up to a frictionless experience when platform users want to create services that they need to deliver value."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Now that you know more about Kratix Promises, follow the steps below to install a Promise."}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsx)("hr",{}),"\n",(0,r.jsx)(n.h2,{id:"install-the-kratix-sample-jenkins-promise",children:"Install the Kratix sample Jenkins Promise"}),"\n",(0,r.jsx)(n.p,{children:"Now that your system is set up, you can install your first Kratix Promise! This guide will follow the steps below:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#install-the-jenkins-promise",children:"Install the Jenkins Promise"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#request-resource",children:"Request a new Jenkins Resource"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#use-your-jenkins",children:"Use the Jenkins"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#cleanup",children:"Clean up environment"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Overview",src:s(7547).A+"",width:"4909",height:"3258"})}),"\n",(0,r.jsx)(n.h3,{id:"install-the-jenkins-promise",children:"Install the Jenkins Promise"}),"\n",(0,r.jsxs)(n.admonition,{type:"tip",children:[(0,r.jsxs)(n.p,{children:["In this guide, we will be using Promises available on the ",(0,r.jsx)(n.a,{href:"/marketplace",children:"Kratix Marketplace"}),".\nThe commands below will refer to a ",(0,r.jsx)(n.code,{children:"KRATIX_MARKETPLACE_REPO"})," env variable. You can either:"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["clone the ",(0,r.jsx)(n.a,{href:"https://github.com/syntasso/kratix-marketplace",children:"Kratix Marketplace"})," and set it to the path of your local clone:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export KRATIX_MARKETPLACE_REPO=/path/to/kratix-marketplace\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"set it to a remote URL:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'export KRATIX_MARKETPLACE_REPO="https://raw.githubusercontent.com/syntasso/kratix-marketplace/main"\n'})}),"\n"]}),"\n"]})]}),"\n",(0,r.jsx)(n.p,{children:"Installing a Kratix Promise is as simple as applying the Promise YAML definition on your platform cluster:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl --context $PLATFORM apply \\\n  --filename "${KRATIX_MARKETPLACE_REPO}/jenkins/promise.yaml"\n'})}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsxs)(n.p,{children:["Verify that your ",(0,r.jsx)(n.code,{children:"platform"})," cluster has registered Jenkins as a new available Kratix Promise."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl --context $PLATFORM get crds jenkins.marketplace.kratix.io\n"})}),"\n",(0,r.jsx)(n.p,{children:"The above command will give an output similar to"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",children:"NAME                            CREATED AT\njenkins.marketplace.kratix.io   2021-05-10T12:00:00Z\n"})}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsx)("p",{children:(0,r.jsxs)(n.p,{children:["The Jenkins Promise requires the Jenkins Operator to be deployed to the ",(0,r.jsx)("code",{children:"worker"})," Destination clusters. Kratix will deploy the operator when you apply the Promise. You can verify that the Jenkins Operator is now installed ",(0,r.jsx)("br",{}),"\n",(0,r.jsxs)("sub",{children:["(This may take a few minutes so ",(0,r.jsx)("code",{children:"--watch"})," will watch the command. Press ",(0,r.jsx)("kbd",{children:"Ctrl"}),"+",(0,r.jsx)("kbd",{children:"C"})," to stop watching)"]})]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl --context $WORKER get pods --watch\n"})}),"\n",(0,r.jsx)(n.p,{children:"The above command will give an output similar to (it may take a couple of minutes):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",children:"NAME                                READY   STATUS    RESTARTS   AGE\njenkins-operator-7886c47f9c-zschr   1/1     Running   0          1m\n"})}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(n.p,{children:"\ud83c\udf89 Congratulations! You have installed your first Kratix Promise, which means your application teams can now get on-demand Jenkins from your platform."}),"\n",(0,r.jsx)(n.h3,{id:"request-resource",children:"Request a Jenkins Resource"}),"\n",(0,r.jsx)(n.p,{children:"Application developers using your platform will be issued a Jenkins after requesting a new Resource."}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"Verify-Instance",src:s(2616).A+"",width:"5365",height:"2981"})}),"\n",(0,r.jsx)(n.p,{children:"Test your platform by acting as an application developer and submitting a request for a Resource:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl --context $PLATFORM apply \\\n    --filename "${KRATIX_MARKETPLACE_REPO}/jenkins/resource-request.yaml"\n'})}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsxs)(n.p,{children:["Verify that the request was issued on the ",(0,r.jsx)(n.code,{children:"platform"})," cluster."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl --context $PLATFORM get jenkins.marketplace.kratix.io\n"})}),"\n",(0,r.jsx)(n.p,{children:"The above command will give an output similar to"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",children:"NAME      STATUS\nexample   Resource requested\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Eventually (it can take a couple of minutes), a new Jenkins should spin up on your ",(0,r.jsx)(n.code,{children:"worker"})," Destination cluster. You can verify this by running the following command:"]}),"\n",(0,r.jsx)("p",{children:(0,r.jsxs)(n.p,{children:["Verify the Jenkins was created on the worker cluster ",(0,r.jsx)("br",{}),"\n",(0,r.jsxs)("sub",{children:["(This may take a few minutes so ",(0,r.jsx)("code",{children:"--watch"})," will watch the command. Press ",(0,r.jsx)("kbd",{children:"Ctrl"}),"+",(0,r.jsx)("kbd",{children:"C"})," to stop watching)"]})]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl --context $WORKER get pods --watch\n"})}),"\n",(0,r.jsx)(n.p,{children:"The above command will give an output similar to"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",children:"NAME                                READY   STATUS    RESTARTS   AGE\njenkins-dev-example                 1/1     Running   0          1m\njenkins-operator-7886c47f9c-zschr   1/1     Running   0          10m\n"})}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(n.p,{children:"\ud83c\udf89 Congratulations! You have successfully requested and created an on-demand Jenkins from your platform."}),"\n",(0,r.jsx)(n.h3,{id:"use-your-jenkins",children:"Use your Jenkins"}),"\n",(0,r.jsx)(n.p,{children:"Access the UI in a browser to ensure the Jenkins is working."}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsxs)(n.p,{children:["Before you can access Jenkins UI, you must port forward from within the Kubernetes cluster to a local port on your computer. Running the ",(0,r.jsx)(n.code,{children:"port-forward"})," command is continuous\u2014as long as the command is running, the connection stays open."]}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.em,{children:(0,r.jsx)(n.strong,{children:"Open a new terminal to request the port forward"})}),"."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",children:"kubectl --context $WORKER port-forward jenkins-dev-example 8080:8080\n"})})]}),"\n",(0,r.jsx)(n.p,{children:"You can find Jenkins credentials by running:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",metastring:'jsx title="username"',children:"kubectl --context $WORKER get secret jenkins-operator-credentials-dev-example \\\n    -o 'jsonpath={.data.user}' | base64 -d\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",metastring:'jsx title="password"',children:"kubectl --context $WORKER get secret jenkins-operator-credentials-dev-example \\\n    -o 'jsonpath={.data.password}' | base64 -d\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Navigate to ",(0,r.jsx)(n.a,{href:"http://localhost:8080",children:"http://localhost:8080"})," and log in with the\ncredentials. In production, you want the credentials to be stored in a secure\nlocation where it could be accessed by the application team. In this example,\ncredentials are stored as unencrypted Kubernetes secrets."]}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.p,{children:"You installed your first Kratix Promise on your platform. Well done!"}),"\n",(0,r.jsx)(n.p,{children:"To recap the steps you took:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705\xa0\xa0Installed the sample Jenkins Promise"}),"\n",(0,r.jsx)(n.li,{children:"\u2705\xa0\xa0Requested an Jenkins Resource"}),"\n",(0,r.jsx)(n.li,{children:"\u2705\xa0\xa0Tested the Jenkins by logging in to the Jenkins UI"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This is only the beginning of working with Promises. Next you will deploy three different Promises to provide a complete solution for an application team."}),"\n",(0,r.jsx)(n.h2,{id:"cleanup",children:"Clean up environment"}),"\n",(0,r.jsx)(n.p,{children:"To clean up your environment you need to delete the Jenkins Resources and the Jenkins Promise."}),"\n",(0,r.jsx)(n.p,{children:"To delete the Jenkins Resources:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl --context $PLATFORM delete \\\n    --filename "${KRATIX_MARKETPLACE_REPO}/jenkins/resource-request.yaml"\n'})}),"\n",(0,r.jsx)(n.p,{children:"Verify the Jenkins Resource in the platform cluster is gone"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",children:"kubectl --context $PLATFORM get jenkins\n"})}),"\n",(0,r.jsx)(n.p,{children:"and the Jenkins workloads in the worker cluster have been deleted"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",children:"kubectl --context $WORKER get pods\n"})}),"\n",(0,r.jsx)(n.p,{children:"The above command will give an output similar to (it may take a couple of minutes)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",children:"NAME                                READY   STATUS    RESTARTS   AGE\njenkins-operator-7886c47f9c-zschr   1/1     Running   0          1m\n"})}),"\n",(0,r.jsx)(n.p,{children:"Now you can delete the Jenkins Promise"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl --context $PLATFORM delete \\\n  --filename "${KRATIX_MARKETPLACE_REPO}/jenkins/promise.yaml"\n'})}),"\n",(0,r.jsx)(n.p,{children:"Verify the Jenkins Promise is gone"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",children:"kubectl --context $PLATFORM get promises\n"})}),"\n",(0,r.jsx)(n.p,{children:"and the Jenkins Operator is deleted from the worker cluster (this might take a couple minutes)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",children:"kubectl --context $WORKER get pods\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Alternatively, you could delete the Promise directly. By default Kratix will delete all child Resources when a Promise is deleted. For more details, check the ",(0,r.jsx)(n.a,{href:"/main/reference/promises/delete",children:"deletion\nreference docs"})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"--congratulations",children:"\ud83c\udf89 \xa0 Congratulations!"}),"\n",(0,r.jsxs)(n.p,{children:["\u2705\xa0\xa0 You have installed a Kratix Promise and used it to create on-demand Resources. ",(0,r.jsx)("br",{}),"\n\ud83d\udc49\xa0\xa0 Now you will ",(0,r.jsx)(n.a,{href:"writing-a-promise",children:"write your own Promise"}),"."]})]})}function o(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}const c={title:"Installing and using a Promise",description:"Step by step guide to install Kratix and your first Promise."},d="Installing and using a Promise",h={},u=[...a.RM,{value:"What is a Kratix Promise?",id:"what-is-a-kratix-promise",level:2},{value:"Kratix Promises",id:"kratix-promises",level:2},{value:"Install the Kratix sample Jenkins Promise",id:"install-the-kratix-sample-jenkins-promise",level:2},{value:"Install the Jenkins Promise",id:"install-the-jenkins-promise",level:3},{value:"Request a Jenkins Resource",id:"request-resource",level:3},{value:"Use your Jenkins",id:"use-your-jenkins",level:3},{value:"Summary",id:"summary",level:2},{value:"Clean up environment",id:"cleanup",level:2},{value:"\ud83c\udf89 \xa0 Congratulations!",id:"--congratulations",level:2}];function p(e){const n={h1:"h1",header:"header",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"installing-and-using-a-promise",children:"Installing and using a Promise"})}),"\n",(0,r.jsx)(a.Ay,{}),"\n",(0,r.jsx)(o,{})]})}function m(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},2616:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/kratix_diagrams-Get_Instance-fb97a5db7d814c2eafb61a4b3f5422e4.jpg"},7547:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/kratix_diagrams-Install_Promise-68d647afd2c1d34a05bf75c921e99f05.jpg"},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>l});var i=s(6540);const r={},t=i.createContext(r);function a(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);