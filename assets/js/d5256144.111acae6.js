"use strict";(self.webpackChunkkratix_docs=self.webpackChunkkratix_docs||[]).push([[5501],{6030:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>l});var o=s(5893),i=s(1151);const t={title:"SKE Backstage Generator",description:"Documentation for how to use the SKE Backstage Generator to automatically populate your backstage catalog",sidebar_label:"SKE Backstage Generator"},r=void 0,a={id:"ske/backstage/generator",title:"SKE Backstage Generator",description:"Documentation for how to use the SKE Backstage Generator to automatically populate your backstage catalog",source:"@site/docs/ske/02-backstage/03-generator.mdx",sourceDirName:"ske/02-backstage",slug:"/ske/backstage/generator",permalink:"/ske/backstage/generator",draft:!1,unlisted:!1,editUrl:"https://github.com/syntasso/kratix-docs/tree/main/docs/ske/02-backstage/03-generator.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"SKE Backstage Generator",description:"Documentation for how to use the SKE Backstage Generator to automatically populate your backstage catalog",sidebar_label:"SKE Backstage Generator"},sidebar:"skeSidebar",previous:{title:"Configuring the Plugins",permalink:"/ske/backstage/plugins"},next:{title:"YAML File Format",permalink:"/ske/backstage/yaml-file-format"}},c={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"SKE Backstage plugins",id:"ske-backstage-plugins",level:3},{value:"Backstage Destination",id:"destination",level:3},{value:"How does it work?",id:"how-does-it-work",level:2},{value:"Promise Configure",id:"promise-configure",level:3},{value:"Resource Configure",id:"resource-configure",level:3},{value:"Accessing the SKE Generator image",id:"accessing-the-ske-generator-image",level:2},{value:"Using the image in your Workflows",id:"using-the-image-in-your-workflows",level:2},{value:"Customising the generated Components",id:"customising-the-generated-components",level:2},{value:"The Promise Component",id:"the-promise-component",level:3},{value:"The Resource Component",id:"the-resource-component",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"The SKE Backstage Generator provides automated generation of the necessary Template and\nComponent manifests for your Promises and requested Resources."}),"\n",(0,o.jsx)(n.p,{children:"These manifests are read by Backstage and are designed to work seamlessly with the\nSKE Backstage plugins."}),"\n",(0,o.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsx)(n.h3,{id:"ske-backstage-plugins",children:"SKE Backstage plugins"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"ske-backstage-generator"})," uses an action from the ",(0,o.jsx)(n.code,{children:"ske-backend"})," Backstage plugin.\nThis action is used within the generated Template to create a Resource Request.\nThe generated Components are also used by the ",(0,o.jsx)(n.code,{children:"ske-frontend"})," Backstage plugin to display\nPromise and Resource metadata."]}),"\n",(0,o.jsxs)(n.p,{children:["In order to utilise the Templates and Components, you should also install both the\n",(0,o.jsx)(n.code,{children:"ske-backend"})," and ",(0,o.jsx)(n.code,{children:"ske-frontend"})," plugins into your Backstage instance."]}),"\n",(0,o.jsxs)(n.p,{children:["See ",(0,o.jsx)(n.a,{href:"./plugins",children:"Configuring the Plugins"})," for instructions."]}),"\n",(0,o.jsx)(n.h3,{id:"destination",children:"Backstage Destination"}),"\n",(0,o.jsxs)(n.p,{children:["You must have a Destination created with the ",(0,o.jsx)(n.code,{children:"environment: backstage"})," label. See the\n",(0,o.jsx)(n.a,{href:"./configuring-backstage#configure-a-destination-for-backstage",children:"Kratix Backstage docs"}),"\nfor setup instructions."]}),"\n",(0,o.jsx)(n.h2,{id:"how-does-it-work",children:"How does it work?"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"ske-backstage-generator"})," image is intended to be run as part of your Configure\nPipeline for your Promise and Resource Workflows. It will auto-generate Backstage Template\nand Component manifests, and schedule them to your ",(0,o.jsx)(n.a,{href:"#destination",children:"Backstage Destination"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"promise-configure",children:"Promise Configure"}),"\n",(0,o.jsx)(n.p,{children:"In a Promise Configure workflow, two Backstage manifests will be generated:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Promise Component:"})," A Backstage Component representing the Promise."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Promise Template:"})," A Backstage Template representing the Promise API (i.e. the CRD\nfor Resources created fromt this Promise)."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Check the ",(0,o.jsx)(n.a,{href:"./yaml-file-format",children:"YAML File Format"})," for examples of these manifests."]}),"\n",(0,o.jsx)(n.h3,{id:"resource-configure",children:"Resource Configure"}),"\n",(0,o.jsx)(n.p,{children:"In a Resource Configure workflow, a single Backstage manifest will be generated:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Resource Component:"})," A Backstage Component representing the Resource."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Check the ",(0,o.jsx)(n.a,{href:"./yaml-file-format",children:"YAML File Format"})," for examples of these manifests."]}),"\n",(0,o.jsx)(n.h2,{id:"accessing-the-ske-generator-image",children:"Accessing the SKE Generator image"}),"\n",(0,o.jsx)(n.p,{children:"The image is hosted in a private registry. To access the image, you will need to\nauthenticate using the token you have been provided with. For docker, you can\nrun the following command, providing your token as the password when prompted:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker login ghcr.io --username syntasso-pkg\n"})}),"\n",(0,o.jsx)(n.p,{children:"If you are using a different container engine, follow the docs for your specific\ntool."}),"\n",(0,o.jsx)(n.p,{children:"Once you have authenticated, you should be able to pull the image:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"docker pull ghcr.io/syntasso/ske-backstage-generator:v0.3.0\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Your Kubernetes cluster must have permission to ",(0,o.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/containers/images/#configuring-nodes-to-authenticate-to-a-private-registry",children:"pull this image from the\nprivate\nregistry"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["If you are following the ",(0,o.jsx)(n.a,{href:"/main/quick-start",children:"quick-start guide"}),", you can load the image\ndirectly to the Kubernetes cache. Different tools have different commands for this. For example:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# For minikube\nminikube image load ghcr.io/syntasso/ske-backstage-generator:v0.3.0\n\n# For KinD\nkind load docker-image ghcr.io/syntasso/ske-backstage-generator:v0.3.0\n"})}),"\n",(0,o.jsx)(n.p,{children:"For other tools, follow their specific documentation."}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsx)(n.p,{children:"If your cluster is running in a secure environment, you may wish to pull this image and\npush it to an internal registry which your cluster has permission to pull from."})}),"\n",(0,o.jsx)(n.h2,{id:"using-the-image-in-your-workflows",children:"Using the image in your Workflows"}),"\n",(0,o.jsxs)(n.p,{children:["To use the ",(0,o.jsx)(n.code,{children:"ske-backstage-generator"})," image, update your Promise definition to include the\ngenerator as a workflow step for both the Promise Configure and Resource Configure\nworkflows:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="workflows section in a Promise file"',children:"  # ...\n  workflows:\n    promise:\n      configure:\n      - apiVersion: platform.kratix.io/v1alpha1\n        kind: Pipeline\n        metadata:\n          name: promise-configure\n          namespace: default\n        spec:\n          containers:\n          - image: ghcr.io/syntasso/kratix-marketplace/jenkins-configure-pipeline:v0.1.0\n            name: jenkins-promise-pipeline\n          #highlight-start\n          - image: ghcr.io/syntasso/ske-backstage-generator:v0.3.0\n            name: ske-backstage-generator\n          #highlight-end\n"})}),"\n",(0,o.jsx)(n.p,{children:"Once your Promise is updated, the generator will be run as part of your\nWorkflows. If you install the Promise, you should see a Component automatically\nappearing in your Backstage instance, together with a new Template. If you use\nthe Template to create a Resource, you should see the resource Component\nappearing as well as the Resource itself being created in your cluster."}),"\n",(0,o.jsx)(n.h2,{id:"customising-the-generated-components",children:"Customising the generated Components"}),"\n",(0,o.jsx)(n.h3,{id:"the-promise-component",children:"The Promise Component"}),"\n",(0,o.jsxs)(n.p,{children:["By default, the generator will create the Backstage Promise ",(0,o.jsx)(n.code,{children:"Component"})," with the\nfollowing ",(0,o.jsx)(n.code,{children:"spec"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"spec:\n  type: kratix-promise\n  lifecycle: production\n  owner: kratix\n"})}),"\n",(0,o.jsxs)(n.p,{children:["To customise these values, or to include any addionatal field (as defined in the\n",(0,o.jsx)(n.a,{href:"https://backstage.io/docs/features/software-catalog/descriptor-format#kind-component",children:"Backstage\ndocs"}),"\nyou can set the following ",(0,o.jsx)(n.code,{children:"env"})," variables in the workflow:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"COMPONENT_TYPE"}),": the value of ",(0,o.jsx)(n.code,{children:"spec.type"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"COMPONENT_LIFECYCLE"}),": the value of ",(0,o.jsx)(n.code,{children:"spec.lifecycle"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"COMPONENT_OWNER"}),": the value of ",(0,o.jsx)(n.code,{children:"spec.owner"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"COMPONENT_SYSTEM"}),": the value of ",(0,o.jsx)(n.code,{children:"spec.system"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"COMPONENT_SUBCOMPONENT_OF"}),": the value of ",(0,o.jsx)(n.code,{children:"spec.subcomponentOf"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"COMPONENT_PROVIDES_APIS"}),": comma-separated list of values for ",(0,o.jsx)(n.code,{children:"spec.providesApis"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"COMPONENT_CONSUMES_APIS"}),": comma-separated list of values for ",(0,o.jsx)(n.code,{children:"spec.consumesApis"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"COMPONENT_DEPENDS_ON"}),": comma-separated list of values for ",(0,o.jsx)(n.code,{children:"spec.dependsOn"})]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["For example, to set ",(0,o.jsx)(n.code,{children:"spec.owner"})," and ",(0,o.jsx)(n.code,{children:"spec.providesApis"}),", you can update your\npipeline stage with the snippet below:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="Promise workflow with custom Component values"',children:'  #...\n  workflows:\n    promise:\n      configure:\n      - apiVersion: platform.kratix.io/v1alpha1\n        kind: Pipeline\n        metadata:\n          name: promise-configure\n          namespace: default\n        spec:\n          containers:\n          - image: ghcr.io/syntasso/kratix-marketplace/jenkins-configure-pipeline:v0.1.0\n            name: jenkins-promise-pipeline\n          - image: ghcr.io/syntasso/ske-backstage-generator:v0.3.0\n            name: ske-backstage-generator\n            #highlight-start\n            env:\n            - name: COMPONENT_OWNER\n              value: "platform-team"\n            - name: COMPONENT_PROVIDES_APIS\n              value: "component/api/v1,component/api/v2"\n            #highlight-end\n\n'})}),"\n",(0,o.jsx)(n.h3,{id:"the-resource-component",children:"The Resource Component"}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"Component"})," for a Resource will have the following ",(0,o.jsx)(n.code,{children:"spec"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"spec:\n  type: kratix-resource\n  lifecycle: production\n  owner: kratix\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Similar to the Promise Component, you can customise these values by setting the\nsame set of ",(0,o.jsx)(n.code,{children:"env"})," variables defined above, but in the Resource Configure workflow."]}),"\n",(0,o.jsx)(n.p,{children:"You can also customise the fields by setting the following annotations in the\nResource object itself:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ske.backstage.component/type"}),": the value of ",(0,o.jsx)(n.code,{children:"spec.type"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ske.backstage.component/lifecycle"}),": the value of ",(0,o.jsx)(n.code,{children:"spec.lifecycle"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ske.backstage.component/owner"}),": the value of ",(0,o.jsx)(n.code,{children:"spec.owner"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ske.backstage.component/system"}),": the value of ",(0,o.jsx)(n.code,{children:"spec.system"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ske.backstage.component/subcomponentOf"}),": the value of ",(0,o.jsx)(n.code,{children:"spec.subcomponentOf"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ske.backstage.component/providesApis"}),": comma-separated list of values for ",(0,o.jsx)(n.code,{children:"spec.providesApis"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ske.backstage.component/consumesApis"}),": comma-separated list of values for ",(0,o.jsx)(n.code,{children:"spec.consumesApis"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ske.backstage.component/dependsOn"}),": comma-separated list of values for ",(0,o.jsx)(n.code,{children:"spec.dependsOn"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>a,a:()=>r});var o=s(7294);const i={},t=o.createContext(i);function r(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);