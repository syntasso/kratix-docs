<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-main/reference/workflows" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Workflows | Kratix</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.kratix.io/main/reference/workflows"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="kratix docs, kratix documentation"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Workflows | Kratix"><meta data-rh="true" name="description" content="Learn more about conventions in workflows"><meta data-rh="true" property="og:description" content="Learn more about conventions in workflows"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.kratix.io/main/reference/workflows"><link data-rh="true" rel="alternate" href="https://docs.kratix.io/main/reference/workflows" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.kratix.io/main/reference/workflows" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://0T1XCKLOOH-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Reference","item":"https://docs.kratix.io/category/reference"},{"@type":"ListItem","position":2,"name":"Workflows","item":"https://docs.kratix.io/main/reference/workflows"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kratix RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kratix Atom Feed">

<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-M8KNBP6C",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>



<link rel="search" type="application/opensearchdescription+xml" title="Kratix" href="/opensearch.xml">


<script src="https://app.termly.io/resource-blocker/6f1bb777-b1e3-40d9-a340-e80f132710f0?autoBlock=on"></script><link rel="stylesheet" href="/assets/css/styles.ee7c28fc.css">
<script src="/assets/js/runtime~main.224dbe4b.js" defer="defer"></script>
<script src="/assets/js/main.26525aae.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M8KNBP6C" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://kratix.io" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/kratix-purple-io.svg" alt="Kratix Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/kratix-white-io.svg" alt="Kratix Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a class="navbar__item navbar__link" href="/workshop/intro">Workshop</a><a class="navbar__item navbar__link" href="/marketplace">Marketplace</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/ske">Enterprise</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/syntasso/kratix" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository">syntasso/kratix<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://kratixworkspace.slack.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link" aria-label="Kratix Slack Workspace"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/main/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/category/reference">Reference</a><button aria-label="Collapse sidebar category &#x27;Reference&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/main/reference/promises/intro">Promises</a><button aria-label="Expand sidebar category &#x27;Promises&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/main/reference/workflows">Workflows</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/main/reference/destinations/intro">Destinations</a><button aria-label="Expand sidebar category &#x27;Destinations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/main/reference/statestore/intro">State Stores</a><button aria-label="Expand sidebar category &#x27;State Stores&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/main/reference/resources/intro">Resources</a><button aria-label="Expand sidebar category &#x27;Resources&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/reference/healthrecord">Health Records</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/reference/kratix-config/config">Kratix Config</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/main/reference/deleting-kratix">Uninstalling Kratix</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/category/guides">Guides</a><button aria-label="Expand sidebar category &#x27;Guides&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/category/learn-more">Learn More</a><button aria-label="Expand sidebar category &#x27;Learn More&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/main/kratix-cli/intro">Kratix CLI</a><button aria-label="Expand sidebar category &#x27;Kratix CLI&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/category/promise-sdks">Promise SDKs</a><button aria-label="Expand sidebar category &#x27;Promise SDKs&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/main/faq">Frequently Asked Questions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/main/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/main/community">Community</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/category/reference"><span>Reference</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Workflows</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Workflows</h1></header><p>A <a href="/main/reference/promises/intro">Kratix Promise</a> can be configured with a series of <strong>workflows</strong>
for both Promises and Resources, defined within the Promise <code>workflows</code> field.</p>
<p>Within the workflows, Promise writers can define a series of actions that will be executed
when certain conditions are met in the system.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2>
<p>The supported workflows are summarised in the table below. See the other sections on this
page for details.</p>
<table><thead><tr><th></th><th>Trigger(s)</th><th>Supported Pipelines</th></tr></thead><tbody><tr><td><strong>Promise Configure</strong></td><td>The Promise is created, updated, or reconciled</td><td>Multiple, executed serially</td></tr><tr><td><strong>Promise Delete</strong></td><td>The Promise is deleted</td><td>Single</td></tr><tr><td><strong>Resource Configure</strong></td><td>The Resource is created, updated or reconciled, or the parent Promise is updated</td><td>Multiple, executed serially</td></tr><tr><td><strong>Resource Delete</strong></td><td>The Resource is deleted</td><td>Single</td></tr></tbody></table>
<p>An example of how <code>workflows</code> are defined within the Promise is shown below.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">platform</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> platform.kratix.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Promise</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">workflows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">configure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Pipeline definitions (multiple)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">delete</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Pipeline definition (single)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">promise</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">configure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Pipeline definitions (multiple)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">delete</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Pipeline definition (single)</span><br></span></code></pre></div></div>
<p>A particular workflow (e.g. <code>resource.configure</code>) is an array of Kratix Pipeline objects
that will be executed in order.</p>
<p>See the next section to learn how to define a Pipeline.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pipelines">Pipelines<a href="#pipelines" class="hash-link" aria-label="Direct link to Pipelines" title="Direct link to Pipelines">​</a></h2>
<p>A Kratix <code>Pipeline</code> kind is a simple wrapper around a Kubernetes Pod.</p>
<p>Pipelines will automatically mount the necessary <a href="#volumes">Kratix Volumes</a> and set
<a href="#environment-variables">Environment Variables</a> for the provided containers.</p>
<p>Any <code>labels</code> and <code>annotations</code> provided in the Pipeline spec will be passed
through to the underlying Pod spec.</p>
<p>An example Pipeline is shown below.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> platform.kratix.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Name (must be unique within the Promise)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Labels (optional)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Annotations (optional)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">jobOptions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Number of times Kubernetes retries a failing workflow Job before marking it failed.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">backoffLimit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> myvolume </span><span class="token comment" style="color:#999988;font-style:italic"># Volume definitions, in addition to `/kratix` volumes (optional)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mycontainer </span><span class="token comment" style="color:#999988;font-style:italic"># Container name (must be unique within the Pipeline)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> registry.example.com/myorg/myimage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">latest </span><span class="token comment" style="color:#999988;font-style:italic"># Container image to run</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Supported fields passed through to underlying Pod spec (all optional):</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;echo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">args</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Hello, World!&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> MY_ENV_VAR </span><span class="token comment" style="color:#999988;font-style:italic"># Static environment variable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">envFrom</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">configMapRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">configmap </span><span class="token comment" style="color:#999988;font-style:italic"># Reference to a ConfigMap to load env vars from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">claims</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> myclaim </span><span class="token comment" style="color:#999988;font-style:italic"># Resource claim to use for the container</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">request</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> myclaim</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">request </span><span class="token comment" style="color:#999988;font-style:italic"># Request for the resource claim</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Resource requests for the container</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;64Mi&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Memory request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;250m&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># CPU request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Resource limits for the container</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;128Mi&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Memory limit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;500m&quot;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># CPU limit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> myvolume </span><span class="token comment" style="color:#999988;font-style:italic"># Volume mount definitions, in addition to `/kratix` volumes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /path/in/container </span><span class="token comment" style="color:#999988;font-style:italic"># Path in the container to mount the volume</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">imagePullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> IfNotPresent </span><span class="token comment" style="color:#999988;font-style:italic"># Either Always, IfNotPresent or Never</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Optional. Can be configured directly or via kratix config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">runAsNonRoot</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">imagePullSecrets</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span></code></pre></div></div>
<p>Refer to the <a href="https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#PodSpec" target="_blank" rel="noopener noreferrer">Kubernetes Pod Spec
documentation</a>
for more information on the fields above.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Not all fields from the Pod spec are supported. We will add support for more fields in
the future.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="job-lifecycle">Job Lifecycle<a href="#job-lifecycle" class="hash-link" aria-label="Direct link to Job Lifecycle" title="Direct link to Job Lifecycle">​</a></h3>
<p>Kratix runs each Pipeline as a <a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/" target="_blank" rel="noopener noreferrer">Kubernetes Job</a>.
You can control how many completed Jobs are kept and how many times a failing Job
is retried via the <a href="/main/reference/kratix-config/config"><code>kratix</code> ConfigMap</a>:</p>
<ul>
<li><code>numberOfJobsToKeep</code> sets the maximum number of successful pipeline Jobs to retain.</li>
<li><code>backoffLimit</code> determines how many times Kubernetes retries a failing Job before
marking it failed. Kratix does not set a default value for this field; if omitted,
Kubernetes uses its own Job default.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rbac">RBAC<a href="#rbac" class="hash-link" aria-label="Direct link to RBAC" title="Direct link to RBAC">​</a></h3>
<p>Each pipeline runs with its own service account and a default set of restrictive
RBAC permissions. By default the service account is automatically created by
Kratix and the name is deterministic. You have three options for providing
additional <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/" target="_blank" rel="noopener noreferrer">RBAC
permissions</a> to
the pipeline:</p>
<ul>
<li>Specify additional <a href="#rbac-permissions">RBAC permissions</a> in your pipeline spec.
Kratix will automatically create the required Role/ClusterRole and
RoleBinding/ClusterRoleBinding</li>
<li>Use the <a href="#service-account">default service account</a> Kratix creates and
manually create the Role/ClusterRole and RoleBinding/ClusterRoleBinding</li>
<li>Specify a <a href="#custom-service-account">custom service account</a> in your pipeline
spec, and manage the lifecycle of the service account yourself, including
creating the required Role/ClusterRole and RoleBinding/ClusterRoleBinding</li>
</ul>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The namespace a resource request pipeline runs in is the same as the namespace as the resource
request. Promise pipelines run in the <code>kratix-platform-system</code> namespace.</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rbac-permissions">RBAC Permissions<a href="#rbac-permissions" class="hash-link" aria-label="Direct link to RBAC Permissions" title="Direct link to RBAC Permissions">​</a></h4>
<p>In the pipeline spec, you can provide additional <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/" target="_blank" rel="noopener noreferrer">RBAC permissions</a> to the
pipeline pod by specifying additional
<a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#role-example" target="_blank" rel="noopener noreferrer">rules</a>
in the <code>.spec.rbac.permissions</code>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">platform: platform.kratix.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Promise</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  workflows:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      configure:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - apiVersion: platform.kratix.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kind: Pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: slack-notify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          rbac:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            permissions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - apiGroups: [&quot;&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                verbs: [&quot;*&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                resources: [&quot;secrets&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - apiGroups: [&quot;batch&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                verbs: [&quot;get&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                resources: [&quot;jobs&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                resourceNames: [&quot;my-job&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span></code></pre></div></div>
<p>The above example provides the pipeline pod with the ability in its own
namespace to have full control over the secrets, and the ability to <code>get</code> a Job
called <code>my-job</code>.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="cross-namespace-rbac-permissions">Cross Namespace RBAC Permissions<a href="#cross-namespace-rbac-permissions" class="hash-link" aria-label="Direct link to Cross Namespace RBAC Permissions" title="Direct link to Cross Namespace RBAC Permissions">​</a></h5>
<p>You can also provide RBAC permissions across namespaces by specifying the
<code>resourceNamespace</code> field in the RBAC permissions. This field is optional and if
not set it defaults to the namespace of the pipeline. If set to <code>*</code>, the
underlying ClusterRole is bound to a ClusterRoleBinding instead of a
RoleBinding, giving the pipeline permissions across all namespaces.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">platform: platform.kratix.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Promise</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  workflows:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      configure:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - apiVersion: platform.kratix.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kind: Pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: slack-notify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          rbac:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            permissions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - apiGroups: [&quot;&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                verbs: [&quot;get&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                resources: [&quot;secrets&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                resourceNamespace: &quot;ns-of-my-secrets&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - apiGroups: [&quot;batch&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                verbs: [&quot;get&quot;, &quot;list&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                resources: [&quot;jobs&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                resourceNamespace: &quot;*&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span></code></pre></div></div>
<p>The above example provides the pipeline pod with the ability get the secrets in
the <code>ns-of-my-secrets</code> namespace regardless of what namespace the pipeline runs
in. The pipeline also has the ability to <code>get</code> and <code>list</code> Jobs across all namespaces.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="service-account">Service Account<a href="#service-account" class="hash-link" aria-label="Direct link to Service Account" title="Direct link to Service Account">​</a></h4>
<p>Each pipelines runs with a <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/" target="_blank" rel="noopener noreferrer">service
account</a>
unique to that namespace, which is automatically created by Kratix when the
pipeline is triggered for the first time. The service account following the
naming convention of
<code>&lt;promise-name&gt;-&lt;workflow-type&gt;-&lt;workflow-action&gt;-&lt;pipeline-name&gt;</code>. For example
the below Promise would create two service accounts:</p>
<div class="language-yaml: codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml: codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">platform: platform.kratix.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Promise</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  workflows:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      delete:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - apiVersion: platform.kratix.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kind: Pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: slack-notify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    promise:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      configure:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - apiVersion: platform.kratix.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kind: Pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: tf-workspace</span><br></span></code></pre></div></div>
<ul>
<li><code>env-resource-delete-slack-notify</code> would be created in each namespace where
the resource request is made</li>
<li><code>env-promise-configure-tf-workspace</code> would be created in the
<code>kratix-platform-system</code> namespace</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="custom-service-account">Custom Service Account<a href="#custom-service-account" class="hash-link" aria-label="Direct link to Custom Service Account" title="Direct link to Custom Service Account">​</a></h4>
<p>You can provide a custom service account for the pipeline by providing the <code>.rbac.serviceAccount</code> field in the pipeline spec.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">platform</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> platform.kratix.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Promise</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">workflows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">resource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">configure</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> platform.kratix.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> slack</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">notify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">rbac</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">serviceAccount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">account</span><br></span></code></pre></div></div>
<p>Kratix will use this service account for the pipeline instead of the standard
one. If it does not exist, Kratix will create it and manage its lifecycle. If it
does exist, Kratix will not modify or delete the service account.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="secrets">Secrets<a href="#secrets" class="hash-link" aria-label="Direct link to Secrets" title="Direct link to Secrets">​</a></h3>
<p>To access Secrets in the Pipeline, you can either <a href="#rbac">provide additional
RBAC</a> so that the pipeline can <code>kubectl get secret</code>  secret or pass in a
reference to the Pipeline container&#x27;s <code>env</code> using <code>valueFrom.secretKeyRef</code> in
the standard Kubernetes way.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>The Secret must be accessible within the Pipeline&#x27;s namespace.</p></div></div>
<p>Refer to the <a href="https://kubernetes.io/docs/concepts/configuration/secret/" target="_blank" rel="noopener noreferrer">Kubernetes documentation</a>
for more details on Secrets in Kubernetes.</p>
<p>Example:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  workflows:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resource/promise:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      configure:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - apiVersion: platform.kratix.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          kind: Pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name: promise</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - image: &lt;image&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: &lt;name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                env:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  # example static env var</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  - name: SLACK_CHANNEL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    value: network-team</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  # example secret env var</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  - name: SLACK_WEBHOOK_URL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    valueFrom:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      secretKeyRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        # this secret needs to exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        name: slack-webhook</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        key: url</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  # example configmap env var</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  - name: SLACK_MSG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    valueFrom:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      configMapKeyRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        name: slack-msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        key: url</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="volumes">Volumes<a href="#volumes" class="hash-link" aria-label="Direct link to Volumes" title="Direct link to Volumes">​</a></h2>
<p>Kratix will run each container in the <code>spec.containers</code> list in order,
providing a set of common volumes, as defined below.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="input">Input<a href="#input" class="hash-link" aria-label="Direct link to Input" title="Direct link to Input">​</a></h3>
<p>Kratix provides an <strong>input directory</strong> to the container, mounted at <code>/kratix/input</code>. This
directory is populated with different files depending on the type of workflow.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="objectyaml"><code>object.yaml</code><a href="#objectyaml" class="hash-link" aria-label="Direct link to objectyaml" title="Direct link to objectyaml">​</a></h4>
<p>In all workflows, all Pipeline containers will have access to an <code>object.yaml</code> file
within the <code>/kratix/input</code> directory.</p>
<p>The contents of this file vary as follows:</p>
<ul>
<li><strong>Promise workflows</strong>: The <code>object.yaml</code> file contains the full Promise definition.</li>
<li><strong>Resource workflows</strong>: The <code>object.yaml</code> file contains the Resource Request definition
which was submitted to the Kratix platform.</li>
</ul>
<p>This is a useful way to find out information about the Kubernetes Object the Pipeline is
being invoked for. For example, you could read the latest <code>status</code> from this input Object
and modify the behaviour of the Pipeline accordingly.</p>
<p>If your workflow contains multiple Pipelines, then the <code>object.yaml</code> is the only way to
communicate between the Pipelines (e.g. via status updates).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="output">Output<a href="#output" class="hash-link" aria-label="Direct link to Output" title="Direct link to Output">​</a></h3>
<p>At the end of a Pipeline, all files present in the <strong>output directory</strong> mounted at
<code>/kratix/output</code> will be written to the <a href="/main/reference/statestore/intro">State Store</a>.</p>
<p>All containers in the Pipeline can write to this volume, and any container can add, update, or remove
documents from this directory.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Files written to <code>/kratix/output</code> in <code>delete</code> Pipelines will be ignored.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="metadata">Metadata<a href="#metadata" class="hash-link" aria-label="Direct link to Metadata" title="Direct link to Metadata">​</a></h3>
<p>All containers in a <code>configure</code> Pipeline have access a shared <strong>metadata directory</strong>
mounted at <code>/kratix/metadata</code>.</p>
<p>Pipeline containers can control aspects of how Kratix behaves by creating special files in
this directory:</p>
<ul>
<li><code>destination-selectors.yaml</code> can be added to any Promise to further refine where the
resources in <code>/kratix/output</code> will be <a href="/main/reference/destinations/multidestination-management">scheduled</a>.</li>
<li><code>status.yaml</code> allows the Pipeline to communicate information about the resource back to
the requester. See the <a href="/main/reference/resources/status">status documentation for more information</a>.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="passing-data-between-containers">Passing data between containers<a href="#passing-data-between-containers" class="hash-link" aria-label="Direct link to Passing data between containers" title="Direct link to Passing data between containers">​</a></h4>
<p>Kratix scans for these files and ignores all other files in the <code>/kratix/metadata</code>
directory. If you need to pass additional information to the next container in
the Pipeline, you can safely write to the <code>/kratix/metadata</code> directory.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="environment-variables">Environment Variables<a href="#environment-variables" class="hash-link" aria-label="Direct link to Environment Variables" title="Direct link to Environment Variables">​</a></h2>
<p>Kratix will set the following environment variables for all containers in the workflow:</p>
<table><thead><tr><th>Variable</th><th>Description</th></tr></thead><tbody><tr><td><code>KRATIX_WORKFLOW_ACTION</code></td><td>The action that triggered the workflow. Either <code>configure</code> or <code>delete</code>.</td></tr><tr><td><code>KRATIX_WORKFLOW_TYPE</code></td><td>The type of workflow. Either <code>resource</code> or <code>promise</code>.</td></tr><tr><td><code>KRATIX_PROMISE_NAME</code></td><td>The name of the Promise.</td></tr><tr><td><code>KRATIX_PIPELINE_NAME</code></td><td>The name of the Pipeline.</td></tr><tr><td><code>KRATIX_OBJECT_KIND</code></td><td>The kind of the object in <code>/kratix/input/object.yaml</code>.</td></tr><tr><td><code>KRATIX_OBJECT_GROUP</code></td><td>The group of the object in <code>/kratix/input/object.yaml</code>.</td></tr><tr><td><code>KRATIX_OBJECT_VERSION</code></td><td>The version of the object in <code>/kratix/input/object.yaml</code>.</td></tr><tr><td><code>KRATIX_OBJECT_NAME</code></td><td>The name of the object in <code>/kratix/input/object.yaml</code>.</td></tr><tr><td><code>KRATIX_OBJECT_NAMESPACE</code></td><td>The namespace of the object in <code>/kratix/input/object.yaml</code>.</td></tr><tr><td><code>KRATIX_CRD_PLURAL</code></td><td>The plural for the API defined in the Promise.</td></tr><tr><td><code>KRATIX_CLUSTER_SCOPED</code></td><td>A boolean for if the Promise API is cluster scoped.</td></tr></tbody></table>
<p>By checking the <code>KRATIX_WORKFLOW_ACTION</code> and <code>KRATIX_WORKFLOW_TYPE</code> environment variables,
a container is able to discover the <strong>context</strong> in which it&#x27;s being invoked (e.g. &quot;I&#x27;m
running as part of a Promise Configure workflow&quot;).</p>
<p>This means that you could write a <strong>single</strong> container image to be used in all four
workflows (<code>promise.configure</code>, <code>promise.delete</code>, <code>resource.configure</code>, and
<code>resource.delete</code>), and switch the container&#x27;s mode of operation based on the context.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="security-context">Security Context<a href="#security-context" class="hash-link" aria-label="Direct link to Security Context" title="Direct link to Security Context">​</a></h2>
<p>A Pipeline consists of containers provided in the Promise, and 3 Kratix specific
containers. Kratix configures its own containers in the pipeline to run with the
following <a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/" target="_blank" rel="noopener noreferrer">security
context</a>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">securityContext:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allowPrivilegeEscalation: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  capabilities:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    drop:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ALL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  privileged: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  runAsNonRoot: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  seccompProfile:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type: RuntimeDefault</span><br></span></code></pre></div></div>
<p>A Pod level security context is not set and cannot currently be configured.</p>
<p>Any containers provided in the Promise will by default not have any security
context set. You can set the security context for the Promise specific
containers (not Kratix containers) by either:</p>
<ul>
<li>
<p>Specifying the security context in the container spec, e.g.:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> platform.kratix.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Name (must be unique within the Promise)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Container name (must be unique within the Pipeline)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Container image to run</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">securityContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Security context fields, e.g.:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">runAsNonRoot</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><br></span></code></pre></div></div>
</li>
<li>
<p>Specifying a global default security context in the <code>kratix</code> ConfigMap in the
<code>kratix-platform-system</code>. See the <a href="/main/reference/kratix-config/config">Kratix Config documentation</a> for more information.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kratix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kratix</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">platform</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    workflows:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      defaultContainerSecurityContext:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        # Security context fields, e.g.:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">        runAsNonRoot: false</span><br></span></code></pre></div></div>
</li>
</ul>
<p>Any security context set in the container spec will override the global default
security context.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="workflows-namespace">Workflows namespace<a href="#workflows-namespace" class="hash-link" aria-label="Direct link to Workflows namespace" title="Direct link to Workflows namespace">​</a></h2>
<p>Promise workflows will run in the <code>kratix-platform-system</code> namespace. Resource workflows will run in the same
namespace as the resource request. If you would like to have all workflows of a given Promise
to run in a specific namespace, regardless of where resource requests are created, you can set
<code>spec.workflows.config.pipelineNamespace</code>.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">platform</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> platform.kratix.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Promise</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">workflows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">pipelineNamespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> team</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a </span><span class="token comment" style="color:#999988;font-style:italic"># optional; needs to be an existing namespace, or else the Promise will fail to install</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/syntasso/kratix-docs/tree/main/docs/main/03-reference/12-workflows.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/main/reference/promises/workflows"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Workflows</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/main/reference/destinations/intro"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Destinations</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#pipelines" class="table-of-contents__link toc-highlight">Pipelines</a><ul><li><a href="#job-lifecycle" class="table-of-contents__link toc-highlight">Job Lifecycle</a></li><li><a href="#rbac" class="table-of-contents__link toc-highlight">RBAC</a></li><li><a href="#secrets" class="table-of-contents__link toc-highlight">Secrets</a></li></ul></li><li><a href="#volumes" class="table-of-contents__link toc-highlight">Volumes</a><ul><li><a href="#input" class="table-of-contents__link toc-highlight">Input</a></li><li><a href="#output" class="table-of-contents__link toc-highlight">Output</a></li><li><a href="#metadata" class="table-of-contents__link toc-highlight">Metadata</a></li></ul></li><li><a href="#environment-variables" class="table-of-contents__link toc-highlight">Environment Variables</a></li><li><a href="#security-context" class="table-of-contents__link toc-highlight">Security Context</a></li><li><a href="#workflows-namespace" class="table-of-contents__link toc-highlight">Workflows namespace</a></li></ul></div></div></div></div></main></div></div></div><img id="docs-scarf-pixel" style="height:1px;width:1px" referrerpolicy="no-referrer-when-downgrade" src="https://static.scarf.sh/a.png?x-pxid=2f7703a4-9013-4c6f-b09e-894a5f3f42d6"><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Getting Started</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://kratix.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kratix<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/syntasso/kratix" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://syntasso.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Syntasso<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://app.termly.io/policy-viewer/policy.html?policyUUID=904a9e3b-575b-4156-8377-ed6ec8829d77" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Syntasso Limited. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>