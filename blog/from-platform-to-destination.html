<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">How your Resources get from Promise to Destination | Kratix</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.kratix.io/blog/from-platform-to-destination"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="kratix docs, kratix documentation"><meta data-rh="true" property="og:title" content="How your Resources get from Promise to Destination | Kratix"><meta data-rh="true" name="description" content="The journey of a document from the Platform Cluster to a Destination"><meta data-rh="true" property="og:description" content="The journey of a document from the Platform Cluster to a Destination"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-11-20T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/kirederik"><meta data-rh="true" property="article:tag" content="kratix,kratix internals,debugging"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.kratix.io/blog/from-platform-to-destination"><link data-rh="true" rel="alternate" href="https://docs.kratix.io/blog/from-platform-to-destination" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.kratix.io/blog/from-platform-to-destination" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://0T1XCKLOOH-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://docs.kratix.io/blog/from-platform-to-destination","mainEntityOfPage":"https://docs.kratix.io/blog/from-platform-to-destination","url":"https://docs.kratix.io/blog/from-platform-to-destination","headline":"How your Resources get from Promise to Destination","name":"How your Resources get from Promise to Destination","description":"The journey of a document from the Platform Cluster to a Destination","datePublished":"2024-11-20T00:00:00.000Z","author":{"@type":"Person","name":"Derik Evangelista","description":"Engineer @ Syntasso","url":"https://github.com/kirederik","image":"https://2.gravatar.com/avatar/7ac63fbda18c97f6a7fab8af157021367793187f4c5830eb722ff565c5a767e9?size=256"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://docs.kratix.io/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kratix RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kratix Atom Feed">

<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-M8KNBP6C",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>



<link rel="search" type="application/opensearchdescription+xml" title="Kratix" href="/opensearch.xml">


<script src="https://app.termly.io/resource-blocker/6f1bb777-b1e3-40d9-a340-e80f132710f0?autoBlock=on"></script><link rel="stylesheet" href="/assets/css/styles.44a3aa93.css">
<script src="/assets/js/runtime~main.c0b8be0b.js" defer="defer"></script>
<script src="/assets/js/main.094fe7f4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M8KNBP6C" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://kratix.io" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/kratix-purple-io.svg" alt="Kratix Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/kratix-white-io.svg" alt="Kratix Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/">Docs</a><a class="navbar__item navbar__link" href="/workshop/intro">Workshop</a><a class="navbar__item navbar__link" href="/marketplace">Marketplace</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/syntasso/kratix" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><a href="https://kratixworkspace.slack.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-slack-link" aria-label="Kratix Slack Workspace"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/debugging-promise-updates">Debugging in Kratix</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/compound-promises">How to write Compound Promises</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/from-platform-to-destination">How your Resources get from Promise to Destination</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/sept-2024-product-update">September Product Update</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">How your Resources get from Promise to Destination</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-11-20T00:00:00.000Z">November 20, 2024</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/kirederik" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://2.gravatar.com/avatar/7ac63fbda18c97f6a7fab8af157021367793187f4c5830eb722ff565c5a767e9?size=256" alt="Derik Evangelista"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/kirederik" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Derik Evangelista</span></a></div><small class="authorTitle_nd0D" title="Engineer @ Syntasso">Engineer @ Syntasso</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>Ever wondered how Kratix actually gets your documents from the Platform Cluster
to the correct Destination?</p>
<p>The Syntasso Team has recently introduced a
<a href="https://github.com/syntasso/kratix/pull/243" target="_blank" rel="noopener noreferrer">change</a> to
Kratix to reduce the size of the Work object. While this change is mostly
internal, we wanted to share how the innards of Kratix work.</p>
<p>So brace yourself to learn:</p>
<ul>
<li>how Kratix moves documents from Platform to Destinations</li>
<li>what works and workplacements are</li>
<li>how to inspect works to debug your Promises</li>
</ul>
<p>You are probably already familiar with how Kratix works at a high level and with
the diagram below:</p>
<figure class="diagram"><img class="large" src="/assets/images/figure01-92cbe3bb6fd370c414771a72acf70c3c.png" alt="High level diagram explaining how
Kratix processes requests"><figcaption>How Kratix processes a request to a Kubernetes Destination</figcaption></figure>
<p>As illustrated above:</p>
<ol>
<li>The user sends a new <strong>App Request</strong> to the Platform Cluster.</li>
<li>The <strong>Promise</strong> reacts to that request and triggers the <strong>Resource Configure
Workflows</strong>.</li>
<li>The Workflow completes and outputs a <strong>series of documents</strong> to be scheduled
to a <strong>Destination</strong>.</li>
<li>These documents are written to a specific directory in the <strong>State Store</strong>.</li>
<li>In the diagram, the documents are scheduled to a Kubernetes <strong>Destination</strong>.
These type of Destination usually have Flux (or ArgoCD, or another GitOps
tool) watching the State Store. The tool picks up the new documents.</li>
<li>The documents are then processed and applied to the Destination.</li>
<li>The <strong>App</strong> becomes operational on the Destination.</li>
</ol>
<p>In this post, I&#x27;m going to expand on points (3) and (4): what happens at the end
of the Workflow? How is the document written to the State Store? And how does
the change linked above affect this process?</p>
<hr>
<!-- -->
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>If the diagram is new to you, I recommend checking out the <a href="http://localhost:3000/workshop/part-i/intro" target="_blank" rel="noopener noreferrer">Part I of the
Kratix Workshop</a> for an overview of
Kratix.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-dive-into-kratix-internals">A Dive into Kratix Internals<a href="#a-dive-into-kratix-internals" class="hash-link" aria-label="Direct link to A Dive into Kratix Internals" title="Direct link to A Dive into Kratix Internals">​</a></h2>
<p>The casual observers among you may have noticed that, when installing Kratix, a
couple of CRDs are also created but not prominently mentioned in the guides
or workshops: the <strong>Work</strong> and the <strong>WorkPlacement</strong>.</p>
<p>The <strong>Work</strong> CRD contains the definition of, well, a Work. All the documents
output by a workflow are captured in the Work Object as <strong>workloads</strong>. Each
document corresponds to a workload entry in the Work object. These workloads are
grouped by the <strong>destination selectors</strong> specified by both the Workflow and the
Promise.</p>
<p>In other words, the Work object encapsulates everything needed to schedule the
workloads to the Destinations.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>How does the Work gets created?</div><div class="admonitionContent_BuS1"><p>Keen observers may have notice the few extra containers that are included in the
Workflow Job. One of these containers is called <code>work-writer</code>. As the name
suggests, it handles creating the Work object at the end of the Workflow. 😉</p></div></div>
<p>One of the controllers bundled with Kratix is the <strong>Work Controller</strong>. This
controller is responsible for finding out all the available Destinations and
selecting the right one for each workload in a Work. It achieves this by
monitoring Work objects and creating a <strong>WorkPlacement</strong> object for each
workload.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>What if there&#x27;s no Destination to schedule a workload?</div><div class="admonitionContent_BuS1"><p>The Work Controller marks the Work as <strong>Unscheduled</strong>. You can verify this by
checking the <code>Scheduled</code> condition in the <code>status</code> field of the Work Object.</p><p>Once a Destination becomes available, the system will automatically try to
schedule any unscheduled Work.</p></div></div>
<p>The <strong>WorkPlacement</strong> object serves as a link between a Work (or specifically, a
workload group within the Work) and a Destination. It contains a copy of the
Workloads and information about the Destination it is scheduled to.</p>
<p>The WorkPlacement controller reacts to WorkPlacements and ensures the workloads
are written to the State Store associated with the Destination.</p>
<p>The diagram below illustrates the Work and WorkPlacement objects in details:</p>
<figure class="diagram"><img class="large" src="/assets/images/figure02-e8156b88651cd0ac3bec1b7d33b0ebc4.png" alt="A Work with two workloads, from
which two WorkPlacements are generated"><figcaption>A Work generating two WorkPlacements</figcaption></figure>
<p>In summary:</p>
<ul>
<li>The contents of a Workflow output are combined into a single Work object. Each
document has an associated <code>workload</code> entry in the Work.</li>
<li>Workloads are grouped by the destination selectors specified by the Workflow
and the Promise.</li>
<li>From the Work object, a WorkPlacement is created for each Workload group.</li>
<li>The WorkPlacement controller writes the Workloads to the State Store
associated with the Destination.</li>
<li>🎉</li>
</ul>
<p>That means the Work object can get quite large, since it&#x27;s combining all the
documents into a single object. But how large is too large?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="reaching-etcd-limits">Reaching etcd limits<a href="#reaching-etcd-limits" class="hash-link" aria-label="Direct link to Reaching etcd limits" title="Direct link to Reaching etcd limits">​</a></h2>
<p>The answer is about 1.5MB. While the Kubernetes API accepts up to 3MB of data in
a single request, etcd only persist keys up to 1.5MB (by default). Although this
is configurable, it&#x27;s fair to assume that most clusters where Kratix is deployed
will use the default settings.</p>
<p>So what happens if a Work object exceeds 1.5MB? The Configure Workflow fails at
the <code>work-writer</code> container, and the error message isn&#x27;t particularly helpful:</p>
<div class="language-shell-session codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell-session codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token output">etcdserver: request is too large</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>You may see an error message like <code>Request entity too large: limit is 3145728</code>; that means you are hitting the Kubernetes API limit, not the etcd
one.</p></div></div>
<p>While it takes a lot of YAML to be over 1.5MB, you can easily reach such a limit
in your Promise. The <a href="https://github.com/prometheus-operator/prometheus-operator" target="_blank" rel="noopener noreferrer">Prometheus
Operator</a>, for
example, includes 3.7MB of YAML!</p>
<p>This brings us back to the <a href="https://github.com/syntasso/kratix/pull/243" target="_blank" rel="noopener noreferrer">change introduced by
243</a>. In this update, we introduced
gzip compression for the Workload contents before persisting the Work into etcd.
This significantly reduces the size of the Work object (gzip documentation
mentions an average of <a href="https://www.gnu.org/software/gzip/manual/gzip.html" target="_blank" rel="noopener noreferrer">70% reduction in
size</a>). For the Prometheus
Operator, for example, the size of the Work object went from 3.7MB to about
490KB—an 87% reduction 🎉!</p>
<p>The downside? If you inspect the Work object, you’ll see base64-encoded binary
data instead of some nice to read YAML.</p>
<figure class="diagram"><img class="large" src="/assets/images/figure03-920c2f30b0883bc82d0dc0c63992fe44.png" alt="Screenshot of a terminal showing
the Work object with binary data in the contents of a Workload"><figcaption>A compressed Work Object</figcaption></figure>
<p>You can still read it though. To inspect a workload’s contents, decode the
base64 data, then unzip it using this command:</p>
<div class="language-shell-session codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell-session codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token output">kubectl get work &lt;work-name&gt; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token output">  -o jsonpath=&#x27;{.spec.workloadGroups[0].workloads[0].content}&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token output">  | base64 -d \</span><br></span><span class="token-line" style="color:#393A34"><span class="token output">  | gzip -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<figure class="diagram"><img class="large" src="/assets/images/figure04-c7827bda962629f0dea66bca80fc4968.png" alt="Screenshot of a terminal showing
the decompressed contents of a workload from a Work object"><figcaption>A decompressed workload</figcaption></figure>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Check our <a href="/main/troubleshooting">Troubleshooting guide</a> for more information on
how to debug Kratix, including inspecting Works and WorkPlacements.</p></div></div>
<p>Despite compression, large Work objects may still pose challenges. While this
update provides temporary relief, we’ll need to revisit the structure to allow
users to have unbounded fun with their Promises. But that’s a story for another
day.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">  ​</a></h2>
<p>In this post, we dived into the internals of Kratix to understand how a
document moves from the Platform Cluster to a Destination. We saw how the
Work and WorkPlacement objects are used to schedule and write documents to the
State Store. We also saw how the recent change to compress the Workload
contents has helped reduce the size of the Work object.</p>
<p>We hope this post has given you a better understanding of how Kratix works under
the hood. If you have any questions or feedback (or want to see more blog posts
like this) please don&#x27;t hesitate to reach out to us on
<a href="https://kratixworkspace.slack.com/" target="_blank" rel="noopener noreferrer">Slack</a> or
<a href="https://github.com/syntasso/kratix" target="_blank" rel="noopener noreferrer">GitHub</a>.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/kratix">kratix</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/kratix-internals">kratix internals</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/debugging">debugging</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/compound-promises"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">How to write Compound Promises</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/sept-2024-product-update"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">September Product Update</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#a-dive-into-kratix-internals" class="table-of-contents__link toc-highlight">A Dive into Kratix Internals</a></li><li><a href="#reaching-etcd-limits" class="table-of-contents__link toc-highlight">Reaching etcd limits</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><img id="blog-scarf-pixel" style="height:1px;width:1px" referrerpolicy="no-referrer-when-downgrade" src="https://static.scarf.sh/a.png?x-pxid=03fbea28-52ec-43c2-90d3-519166e436b4"><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://kratix.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kratix<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/syntasso/kratix" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://syntasso.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Syntasso<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Syntasso Limited. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>