---
title: Using destination selectors to with multiple Terraform workspaces
description: |
    How to publish resources to different Terraform workspaces using destination
    selectors
sidebar_label: Using multiple Terraform destinations
keywords: [terraform, promise, destination, selectors]
---

One common question when using Kratix with Terraform is how to handle the
situation where requests need to be executed in different Terraform workspaces.

For instance, Team A has a Terraform workspace which should utilised when
infrastructure is created for that team via Terraform, whilst Team B has a
workspace that should accommodate their requests.

This guide will show you how to resolve this with dynamic scheduling within the
Promise by using inputs provided in the request to create Destination selectors
that Kratix will use to execute the request in the right places.

You will:
- Configure different Terraform Destinations
- Create a Promise that provisions AWS resources
- Use team information in the request to target different Terraform destinations


## Pre-requisites

To complete this guide you will need:

1. At least two Terraform workspaces on Terraform Cloud
1. An AWS account the Terraform workspaces can write to
1. kind, to run a local Kubernetes cluster
1. kubectl, to interact with Kubernetes
1. kratix-cli, to create your Promise
1. A working [Kratix installation](./main/04-guides/01-installing-kratix)

## Create Terraform destinations

Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis
nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in
culpa qui officia deserunt mollit anim id est laborum.

## Create a test Promise

Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis
nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.
Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in
culpa qui officia deserunt mollit anim id est laborum.

## Add dynamic scheduling to your Promise

Should a request have the below inputs:

apiVersion: marketplace.kratix.io/v1alpha1
kind: redis
metadata:
  name: example
  namespace: default
  labels:
    non-kratix-label: "true"
spec:
  size: small
  team: team-a
The container can ensure that the works for the container are scheduled to the
Team B destination:


```shell
export TEAM="$(yq eval '.spec.team' /kratix/input/object.yaml)"

echo """
--
- directory: ${TEAM}
  matchLabels:
     team: ${TEAM}     
""" >> /kratix/metadata/destination-selectors.yaml
```

The works are then scheduled to a Destination with the label `team: team-a` and
this is backed by a state store that is watched by a Terraform Workspace.


## ðŸŽ‰ Congratulations

Now you know how you can leverage Destination selectors in Kratix to
dynamically route resources to their intended Terraform workspaces!
